<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Microphysics · CLIMA</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.svg" alt="CLIMA logo"/></a><h1>CLIMA</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../index.html">Home</a></li><li><span class="toctext">Utilites</span><ul><li><a class="toctext" href="../Utilities/RootSolvers.html">RootSolvers</a></li><li><a class="toctext" href="../Utilities/MoistThermodynamics.html">MoistThermodynamics</a></li></ul></li><li><span class="toctext">Atmos</span><ul><li><a class="toctext" href="SurfaceFluxes.html"><code>SurfaceFluxes</code></a></li><li><a class="toctext" href="TurbulenceConvection.html"><code>TurbulenceConvection</code></a></li><li><a class="toctext" href="EDMFEquations.html">Eddy-Diffusivity Mass-Flux (EDMF) equations</a></li><li class="current"><a class="toctext" href="Microphysics.html">Microphysics</a><ul class="internal"><li><a class="toctext" href="#Rain-drop-size-distribution-1">Rain drop size distribution</a></li><li><a class="toctext" href="#Terminal-velocity-1">Terminal velocity</a></li><li><a class="toctext" href="#Cloud-condensation/evaporation-1">Cloud condensation/evaporation</a></li><li><a class="toctext" href="#Autoconversion-1">Autoconversion</a></li><li><a class="toctext" href="#Accretion-1">Accretion</a></li><li><a class="toctext" href="#Rain-evaporation-1">Rain evaporation</a></li><li><a class="toctext" href="#Functions-1">Functions</a></li><li><a class="toctext" href="#References-1">References</a></li></ul></li></ul></li><li><a class="toctext" href="../ODESolvers.html">ODESolvers</a></li><li><a class="toctext" href="../LinearSolvers.html">LinearSolvers</a></li><li><a class="toctext" href="../Mesh.html">Mesh</a></li><li><a class="toctext" href="../Arrays.html">Arrays</a></li><li><a class="toctext" href="../DGmethods.html">DGmethods</a></li><li><a class="toctext" href="../InputOutput.html">InputOutput</a></li><li><span class="toctext">Developer docs</span><ul><li><a class="toctext" href="../CodingConventions.html">Coding Conventions</a></li><li><a class="toctext" href="../AcceptableUnicode.html">Acceptable Unicode characters</a></li><li><a class="toctext" href="../VariableList.html">CliMA Variable List</a></li></ul></li><li><span class="toctext">Balance Law Examples</span><ul><li><a class="toctext" href="../BalanceLawOverview.html">DG Balance Law Method</a></li><li><a class="toctext" href="../examples/DGmethods/generated/ex_001_periodic_advection.html">Example 001: Periodic Advection</a></li><li><a class="toctext" href="../examples/DGmethods/generated/ex_002_solid_body_rotation.html">Example 002: Solid Body Rotation</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Atmos</li><li><a href="Microphysics.html">Microphysics</a></li></ul><a class="edit-page" href="https://github.com/climate-machine/CLIMA/blob/master/docs/src/Atmos/Microphysics.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Microphysics</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Microphysics-Module-1" href="#Microphysics-Module-1">Microphysics Module</a></h1><p>The <code>Microphysics</code> module describes warm rain bulk parameterization of cloud microphysical processes. The module describes the warm rain (no ice and snow) formation and is based on the ideas of Kessler 1995.</p><p>Parameterized processes include:</p><ul><li>rain sedimentation with mass weighted average terminal velocity,</li><li>condensation/evaporation of cloud water,</li><li>autoconversion,</li><li>accretion,</li><li>evaporation of rain water.</li></ul><p>The cloud microphysics variables are expressed as specific humidities:</p><ul><li>q_tot - total water specific humidity,</li><li>q_vap - water vapor specific humidity,</li><li>q_liq - liquid water specific humidity,</li><li>q_rai - rain water specific humidity.</li></ul><p>Parameters used in the parameterization are defined in <code>MicrophysicsParameters</code> module. They consist of:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">definition</th><th style="text-align: right">units</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$n_{0_{MP}}$</span></td><td style="text-align: right">rain drop size distribution parameter</td><td style="text-align: right"><span>$\frac{1}{m^4}$</span></td><td style="text-align: right"><span>$16 \cdot 10^6$</span></td></tr><tr><td style="text-align: right"><span>$\tau_{cond_evap}$</span></td><td style="text-align: right">cloud water condensation/evaporation timescale</td><td style="text-align: right"><span>$s$</span></td><td style="text-align: right"><span>$10$</span></td></tr><tr><td style="text-align: right"><span>$\tau_{acnv}$</span></td><td style="text-align: right">cloud to rain water autoconversion timescale</td><td style="text-align: right"><span>$s$</span></td><td style="text-align: right"><span>$10^3$</span></td></tr><tr><td style="text-align: right"><span>$q_{liq\_threshold}$</span></td><td style="text-align: right">cloud to rain water autoconversion threshold</td><td style="text-align: right">-</td><td style="text-align: right"><span>$5 \cdot 10^{-4}$</span></td></tr><tr><td style="text-align: right"><span>$E_{col}$</span></td><td style="text-align: right">collision efficiency between rain drops and cloud droplets</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.8$</span></td></tr><tr><td style="text-align: right"><span>$C_{drag}$</span></td><td style="text-align: right">rain drop drag coefficient</td><td style="text-align: right">-</td><td style="text-align: right"><span>$0.55$</span></td></tr><tr><td style="text-align: right"><span>$a_{vent}, b_{vent}$</span></td><td style="text-align: right">rain drop ventilation factor coefficients</td><td style="text-align: right">-</td><td style="text-align: right"><span>$1.5 \;$</span>,<span>$\; 0.53$</span></td></tr><tr><td style="text-align: right"><span>$K_{therm}$</span></td><td style="text-align: right">thermal conductivity of air</td><td style="text-align: right"><span>$\frac{J}{m \; s \; K}$</span></td><td style="text-align: right"><span>$2.4 \cdot 10^{-2}$</span></td></tr><tr><td style="text-align: right"><span>$\nu_{air}$</span></td><td style="text-align: right">kinematic viscosity of air</td><td style="text-align: right"><span>$\frac{m^2}{s}$</span></td><td style="text-align: right"><span>$1.6 \cdot 10^{-5}$</span></td></tr><tr><td style="text-align: right"><span>$D_{vapor}$</span></td><td style="text-align: right">diffusivity of water vapor</td><td style="text-align: right"><span>$\frac{m^2}{s}$</span></td><td style="text-align: right"><span>$2.26 \cdot 10^{-5}$</span></td></tr></table><h2><a class="nav-anchor" id="Rain-drop-size-distribution-1" href="#Rain-drop-size-distribution-1">Rain drop size distribution</a></h2><p>The rain-drop size distribution is assumed to follow Marshall-Palmer distribution (Marshall Palmer 1948 eq. 1):</p><div>\[\begin{equation}
n(r) = n_{0_{MP}} exp\left(- \lambda_{MP} \, r \right)
\end{equation}\]</div><p>where:</p><ul><li><span>$r$</span> is the drop radius,</li><li><span>$n_{0_{MP}}$</span> and <span>$\lambda_{MP}$</span> are the Marshall-Palmer distribution parameters (twice the values used in the Marshall Palmer 1948, because we use drop radius and not diameter).</li></ul><h2><a class="nav-anchor" id="Terminal-velocity-1" href="#Terminal-velocity-1">Terminal velocity</a></h2><p>The terminal velocity of an individual rain drop is defined by the balance between the gravitational acceleration (taking into account the density difference between water and air) and the drag force:</p><div>\[\begin{equation}
v_{drop} = \left(\frac{8}{3 \, C_{drag}} \left( \frac{\rho_{water}}{\rho} -1 \right) \right)^{1/2} (g \, r)^{1/2} = v_c(\rho) \, (g \, r)^{1/2}
\label{eq:vdrop}
\end{equation}\]</div><p>where:</p><ul><li><span>$g$</span> is the gravitational acceleration,</li><li><span>$C_{drag}$</span> is the drag coefficient,</li><li><span>$\rho_{water}$</span> is the density of water,</li><li><span>$\rho$</span> is the density of air.</li></ul><p>The mass weighted terminal velocity <span>$v_t$</span> is defined following Ogura and Takahashi 1971</p><div>\[\begin{equation}
v_t = \frac{F_{rain}}{RWC}
\label{eq:vt}
\end{equation}\]</div><p>where:</p><ul><li><span>$F_{rain} = \int_0^\infty n(r) \, m(r) \, v_{drop}(r) \, dr$</span> is the vertical flux of rain drops,</li><li><span>$RWC = \int_0^\infty n(r) \, m(r) \, dr = \rho \, q_{rai}$</span> is the rain water content.</li></ul><p>Integrating over the assumed Marshall-Palmer distribution results in</p><div>\[\begin{equation}
RWC = \frac{8 \pi \, n_{0_{MP}} \, \rho_{water}}{\lambda_{MP}^4}
\label{eq:lambda}
\end{equation}\]</div><div>\[\begin{equation}
F_{rain} = \Gamma \left(\frac{9}{2} \right) \frac{4}{3} n_{0_{MP}} \, \pi \, \rho_{water} v_c(\rho) \, g^{1/2} (\lambda_{MP})^{-9/2}
\label{eq:frain}
\end{equation}\]</div><p>Substituting eq.(\ref{eq:lambda}) and eq.(\ref{eq:frain}) into eq.(\ref{eq:vt}) results in:</p><div>\[\begin{equation}
v_t = \Gamma \left( \frac{9}{2} \right) \, \frac{v_c(\rho)}{6} \, \left( \frac{g}{\lambda_{MP}}\right)^{1/2}
\end{equation}\]</div><p>where <span>$\lambda_{MP}$</span> is computed as</p><div>\[\lambda_{MP} = \left( \frac{8 \pi \rho_{water} n_{0_{MP}}}{\rho q_{rai}} \right)^{1/4}\]</div><p>The default value of <span>$C_{drag}$</span> is chosen such that the <span>$v_t$</span> is close to the empirical terminal velocity formulation in Smolarkiewicz and Grabowski 1996. Assuming a constant drag coefficient is an approximation as it should be size and flow dependent, see <a href="https://www.grc.nasa.gov/www/K-12/airplane/dragsphere.html">drag_coefficient</a>.</p><pre><code class="language-julia">using CLIMA.Microphysics
using Plots

# eq. 5d in Smolarkiewicz and Grabowski 1996
# https://doi.org/10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2
function terminal_velocity_empirical(q_rai::DT, q_tot::DT, ρ::DT, ρ_air_ground::DT) where {DT&lt;:Real}
    rr  = q_rai / (DT(1) - q_tot)
    vel = DT(14.34) * ρ_air_ground^DT(0.5) * ρ^-DT(0.3654) * rr^DT(0.1346)
    return vel
end

q_rain_range = range(1e-8, stop=5e-3, length=100)
ρ_air, q_tot, ρ_air_ground = 1.2, 20 * 1e-3, 1.22

plot(q_rain_range * 1e3,  [terminal_velocity(q_rai, ρ_air) for q_rai in q_rain_range], xlabel=&quot;q_rain [g/kg]&quot;, ylabel=&quot;velocity [m/s]&quot;, title=&quot;Average terminal velocity of rain&quot;, label=&quot;CLIMA&quot;)
plot!(q_rain_range * 1e3, [terminal_velocity_empirical(q_rai, q_tot, ρ_air, ρ_air_ground) for q_rai in q_rain_range], label=&quot;Empirical&quot;)</code></pre><pre><code class="language-none">/home/vsts/.julia/packages/GR/TMylY/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre><p><img src="rain_terminal_velocity.svg" alt/></p><h2><a class="nav-anchor" id="Cloud-condensation/evaporation-1" href="#Cloud-condensation/evaporation-1">Cloud condensation/evaporation</a></h2><p>Condensation and evaporation of cloud water is parameterized as a relaxation to equilibrium value at the current time step.</p><div>\[\begin{equation}
  \left. \frac{d \, q_{liq}}{dt} \right|_{cond, evap} = \frac{q^{eq}_{liq} - q_{liq}}{\tau_{cond\_evap}}
\end{equation}\]</div><p>where:</p><ul><li><span>$q^{eq}_{liq}$</span> - liquid water specific humidity in equilibrium,</li><li><span>$q_{liq}$</span> - liquid water specific humidity,</li><li><span>$\tau_{cond\_evap}$</span> - relaxation timescale (parameter in <code>MicrophysicsParameters</code> module).</li></ul><h2><a class="nav-anchor" id="Autoconversion-1" href="#Autoconversion-1">Autoconversion</a></h2><p>Autoconversion defines the rate of conversion form cloud to rain water due to collisions between cloud droplets. It is parameterized following Kessler 1995:</p><div>\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} = \frac{max(0, q_{liq} - q_{liq\_threshold})}{\tau_{acnv}}
\end{equation}\]</div><p>where:</p><ul><li><span>$q_{liq}$</span> - liquid water specific humidity,</li><li><span>$\tau_{acnv}$</span> - timescale (parameter in <code>MicrophysicsParameters</code> module),</li><li><span>$q_{liq\_threshold}$</span> - autoconversion (parameter in <code>MicrophysicsParameters</code> module).</li></ul><p>The default values of <span>$\tau_{acnv}$</span> and <span>$q_{liq\_threshold}$</span> are based on Smolarkiewicz and Grabowski 1996.</p><h2><a class="nav-anchor" id="Accretion-1" href="#Accretion-1">Accretion</a></h2><p>Accretion defines the rate of conversion from cloud to rain water resulting from collisions between cloud droplets and rain drops. It is parameterized following Kessler 1995:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{accr} = \int_0^\infty n(r) \, \pi r^2 \, v_{drop} E_{col} q_{liq} dr
\end{equation}\]</div><p>where:</p><ul><li><span>$E_{col}$</span> is the collision efficiency,</li><li><span>$v_{drop}$</span> is defined in eq.(\ref{eq:vdrop}).</li></ul><p>Integrating over the distribution and using the RWC to eliminate the <span>$\lambda_{MP}$</span> results in:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{accr}  = \Gamma \left(\frac{7}{2} \right) \pi^{1/8} 8^{-7/8} E_{col} v_c(\rho) \, \left(\frac{\rho}{\rho_{water}}\right)^{7/8} n_{0_{MP}}^{1/8} g^{1/2} q_{liq} q_{rai}^{7/8} = A(\rho) \, n_{0_{MP}}^{1/8} g^{1/2} q_{liq} q_{rai}^{7/8}
\end{equation}\]</div><p>The default value of collision efficiency <span>$E_{coll}$</span> is set to 0.8 so that the resulting accretion rate is close to the empirical accretion rate in Smolarkiewicz and Grabowski 1996. Assuming a constant <span>$E_{col}$</span> is an approximation, see for example <a href="https://journals.ametsoc.org/doi/10.1175/1520-0469%282001%29058%3C0742%3ACEODIA%3E2.0.CO%3B2">collision efficiency</a>.</p><pre><code class="language-julia">using CLIMA.Microphysics
using Plots

# eq. 5b in Smolarkiewicz and Grabowski 1996
# https://doi.org/10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2
function accretion_empirical(q_rai::DT, q_liq::DT, q_tot::DT) where {DT&lt;:Real}
    rr  = q_rai / (DT(1) - q_tot)
    rl  = q_liq / (DT(1) - q_tot)
    return DT(2.2) * rl * rr^DT(7/8)
end

# some example values
q_rain_range = range(1e-8, stop=5e-3, length=100)
ρ_air, q_liq, q_tot = 1.2, 5e-4, 20e-3

plot(q_rain_range * 1e3,  [conv_q_liq_to_q_rai_accr(q_liq, q_rai, ρ_air) for q_rai in q_rain_range], xlabel=&quot;q_rain [g/kg]&quot;, ylabel=&quot;accretion rate [1/s]&quot;, title=&quot;Accretion&quot;, label=&quot;CLIMA&quot;)
plot!(q_rain_range * 1e3, [accretion_empirical(q_rai, q_liq, q_tot) for q_rai in q_rain_range], label=&quot;empirical&quot;)</code></pre><pre><code class="language-none">/home/vsts/.julia/packages/GR/TMylY/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre><p><img src="accretion_rate.svg" alt/></p><h2><a class="nav-anchor" id="Rain-evaporation-1" href="#Rain-evaporation-1">Rain evaporation</a></h2><p>Based on Maxwell 1971 the equation of growth of individual water drop is:</p><div>\[\begin{equation}

r \frac{dr}{dt} = \frac{1}{\rho_{water}}
                  \left(\frac{q_{vap}}{q_{vap}^{sat}} - 1 \right)
                  \left(
                    \frac{L}{KT} \left(\frac{L}{R_v T} - 1 \right) +
                    \frac{R_v T}{p_{vap}^{sat} D}
                  \right)^{-1}
                = \frac{1}{\rho_{water}} S(q_{vap}, q_{vap}^{sat}) \, G(T)
\end{equation}\]</div><p>where:</p><ul><li><span>$q_{vap}^{sat}$</span> is the saturation vapor specific humidity,</li><li><span>$L$</span> is the latent heat of vaporization,</li><li><span>$K_{thermo}$</span> is the thermal conductivity of air,</li><li><span>$R_v$</span> is the gas constant of water vapor,</li><li><span>$D_{vapor}$</span> is the diffusivity of water vapor,</li><li><span>$S(q_{vap}, q_{vap}^{sat}) = \frac{q_{vap}}{q_{vap}^{sat}} - 1$</span> is commonly labeled as supersaturation,</li><li><span>$G(T) = \left(\frac{L}{KT} \left(\frac{L}{R_v T} - 1 \right) + \frac{R_v T}{p_{vap}^{sat} D} \right)^{-1}$</span> combines the effects of thermal conductivity and water diffusivity.</li></ul><p>The rate of <span>$q_{rai}$</span> evaporation is:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{evap}  =  \int_0^\infty \frac{1}{\rho} \, 4 \pi \, r \, S(q_{vap}, q_{vap}^{sat}) \, G(T) \, F(r) \, n(r) \, dr
\end{equation}\]</div><p>where:</p><ul><li><span>$F(r)$</span> is the rain drop ventilation factor.</li></ul><p>Following Seifert and Beheng 2006 eq. 24 the ventilation factor is defined as:</p><div>\[\begin{equation}
F(r) = a_{vent} + b_{vent}  N_{Sc}^{1/3} N_{Re}(r)^{1/2}
\end{equation}\]</div><p>where:</p><ul><li><span>$a_{vent}$</span>, <span>$b_{vent}$</span> are coefficients,</li><li><span>$N_{Sc}$</span> is the Schmidt number,</li><li><span>$N_{Re}$</span> is the Reynolds number of a falling rain drop.</li></ul><p>The Schmidt number is assumed constant:</p><div>\[N_{Sc} = \frac{\nu_{air}}{D_{vapor}}\]</div><p>where:</p><ul><li><span>$\nu_{air}$</span> is the kinematic viscosity of air.</li></ul><p>The Reynolds number of a rain drop is defined as:</p><div>\[N_{Re} = \frac{2 \, r \, v_{drop}(r, \rho)}{\nu_{air}} = \frac{2 v_c(\rho) \, g^{1/2} \, r^{3/2}}{\nu_{air}}\]</div><p>The final integral is:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{evap}  =  4 \pi S(q_{vap}, q_{vap}^{sat}) \frac{n_{0_{MP}} G(T)}{\rho}
                                                  \int_0^\infty \left( a_{vent} r + b_{vent} N_{Sc}^{1/3} (2 v_c(\rho))^{1/2} \frac{g^{1/4}}{\nu_{air}^{1/2}} r^{7/4} \right) exp(-\lambda_{MP} r) dr
\end{equation}\]</div><p>Integrating and eliminating <span>$\lambda_{MP}$</span> using eq.(\ref{eq:lambda}) results in:</p><div>\[\begin{equation}
\left. \frac{d \, q_{rai}}{dt} \right|_{evap}  = S(q_{vap}, q_{vap}^{sat}) \frac{G(T) n_{0_{MP}}^{1/2}}{\rho} \left( A q_{rai}^{1/2} + B \frac{g^{1/4}}{n_{0_{MP}}^{3/16} \nu_{air}^{1/2}} q_{rai}^{11/16} \right)
\end{equation}\]</div><p>where:</p><ul><li><span>$A = (2 \pi)^{1/2} a_{vent} \left( \frac{\rho}{\rho_{water}} \right)^{1/2}$</span></li><li><span>$B = \Gamma\left(\frac{11}{4}\right) 2^{7/16} \pi^{5/16} b_{vent} N_{Sc}^{1/3} v_c(\rho)^{1/2} \left( \frac{\rho}{\rho_{water}} \right)^{11/16}$</span></li></ul><p>The values of <span>$a_{vent}$</span> and <span>$b_{vent}$</span> are chosen so that at <span>$q_{tot} = 15 g/kg$</span> and <span>$T=288K$</span> the resulting rain evaporation rate is close to the empirical rain evaporation rate from Smolarkiewicz and Grabowski 1996.</p><pre><code class="language-julia">using CLIMA.Microphysics
using CLIMA.MoistThermodynamics
using CLIMA.PlanetParameters
using Plots

# eq. 5c in Smolarkiewicz and Grabowski 1996
# https://doi.org/10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2
function rain_evap_empirical(q_rai::DT, q::PhasePartition, T::DT, p::DT, ρ::DT) where {DT&lt;:Real}

    q_sat  = q_vap_saturation(T, ρ, q)
    q_vap  = q.tot - q.liq
    rr     = q_rai / (DT(1) - q.tot)
    rv_sat = q_sat / (DT(1) - q.tot)
    S      = q_vap/q_sat - DT(1)

    ag, bg = 5.4 * 1e2, 2.55 * 1e5
    G = DT(1) / (ag + bg / p / rv_sat) / ρ

    av, bv = 1.6, 124.9
    F = av * (ρ/DT(1e3))^DT(0.525)  * rr^DT(0.525) + bv * (ρ/DT(1e3))^DT(0.7296) * rr^DT(0.7296)

    return DT(1) / (DT(1) - q.tot) * S * F * G
end

# example values
T, p = 273.15 + 15, 90000.
ϵ = 1. / molmass_ratio
p_sat = saturation_vapor_pressure(T, Liquid())
q_sat = ϵ * p_sat / (p + p_sat * (ϵ - 1.))
q_rain_range = range(1e-8, stop=5e-3, length=100)
q_tot = 15e-3
q_vap = 0.15 * q_sat
q_ice = 0.
q_liq = q_tot - q_vap - q_ice
q = PhasePartition(q_tot, q_liq, q_ice)
R = gas_constant_air(q)
ρ = p / R / T

plot(q_rain_range * 1e3,  [conv_q_rai_to_q_vap(q_rai, q, T, p, ρ) for q_rai in q_rain_range], xlabel=&quot;q_rain [g/kg]&quot;, ylabel=&quot;rain evaporation rate [1/s]&quot;, title=&quot;Rain evaporation&quot;, label=&quot;CLIMA&quot;)
plot!(q_rain_range * 1e3, [rain_evap_empirical(q_rai, q, T, p, ρ) for q_rai in q_rain_range], label=&quot;empirical&quot;)</code></pre><pre><code class="language-none">/home/vsts/.julia/packages/GR/TMylY/src/../deps/gr/bin/gksqt: error while loading shared libraries: libQt5Widgets.so.5: cannot open shared object file: No such file or directory
connect: Connection refused
GKS: can&#39;t connect to GKS socket application
Did you start &#39;gksqt&#39;?

GKS: Open failed in routine OPEN_WS
GKS: GKS not in proper state. GKS must be either in the state WSOP or WSAC in routine ACTIVATE_WS</code></pre><p><img src="rain_evaporation_rate.svg" alt/></p><h2><a class="nav-anchor" id="Functions-1" href="#Functions-1">Functions</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CLIMA.Microphysics.terminal_velocity" href="#CLIMA.Microphysics.terminal_velocity"><code>CLIMA.Microphysics.terminal_velocity</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">terminal_velocity(q_rai, ρ)</code></pre><p>where:</p><ul><li><code>q_rai</code> - rain water specific humidity</li><li><code>ρ</code>     - density of air</li></ul><p>Returns the mass weighted average rain terminal velocity assuming Marshall Palmer 1948 distribution of rain drops.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/CLIMA/blob/300156dad47c2f98ab50d5747c19a71f6440579e/src/Atmos/Parameterizations/CloudPhysics/Microphysics.jl#L43-L52">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CLIMA.Microphysics.conv_q_vap_to_q_liq" href="#CLIMA.Microphysics.conv_q_vap_to_q_liq"><code>CLIMA.Microphysics.conv_q_vap_to_q_liq</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">conv_q_vap_to_q_liq(q_sat, q)</code></pre><p>where:</p><ul><li><code>q_sat</code> - PhasePartition at equilibrium</li><li><code>q</code>     - current PhasePartition</li></ul><p>Returns the q_liq tendency due to condensation/evaporation. The tendency is obtained assuming a relaxation to equilibrium with constant timescale.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/CLIMA/blob/300156dad47c2f98ab50d5747c19a71f6440579e/src/Atmos/Parameterizations/CloudPhysics/Microphysics.jl#L66-L76">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CLIMA.Microphysics.conv_q_liq_to_q_rai_acnv" href="#CLIMA.Microphysics.conv_q_liq_to_q_rai_acnv"><code>CLIMA.Microphysics.conv_q_liq_to_q_rai_acnv</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">conv_q_liq_to_q_rai_acnv(q_liq)</code></pre><p>where:</p><ul><li><code>q_liq</code> - is the liquid water specific humidity</li></ul><p>Returns the q_rai tendency due to collisions between cloud droplets (autoconversion) parametrized following Kessler 1995.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/CLIMA/blob/300156dad47c2f98ab50d5747c19a71f6440579e/src/Atmos/Parameterizations/CloudPhysics/Microphysics.jl#L90-L98">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CLIMA.Microphysics.conv_q_liq_to_q_rai_accr" href="#CLIMA.Microphysics.conv_q_liq_to_q_rai_accr"><code>CLIMA.Microphysics.conv_q_liq_to_q_rai_accr</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">conv_q_liq_to_q_rai_accr(q_liq, q_rai, ρ)</code></pre><p>where:</p><ul><li><code>q_liq</code> - is the liquid water specific humidity</li><li><code>q_rai</code> - is the rain water specific humidity</li><li><code>ρ</code> - is the density of air</li></ul><p>Returns the q_rai tendency due to collisions between cloud droplets and rain drops (accretion) parametrized following Kessler 1995.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/CLIMA/blob/300156dad47c2f98ab50d5747c19a71f6440579e/src/Atmos/Parameterizations/CloudPhysics/Microphysics.jl#L105-L115">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="CLIMA.Microphysics.conv_q_rai_to_q_vap" href="#CLIMA.Microphysics.conv_q_rai_to_q_vap"><code>CLIMA.Microphysics.conv_q_rai_to_q_vap</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">conv_q_rai_to_q_vap(q_rai, q, T, p, ρ)</code></pre><p>where:</p><ul><li>q_rai - rain water specific humidity</li><li>q - current PhasePartition</li><li>T - temperature</li><li>p - pressure</li><li>ρ - air density</li></ul><p>Returns the q_rai tendency due to rain evaporation. Parameterized following Smolarkiewicz and Grabowski 1996.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/CLIMA/blob/300156dad47c2f98ab50d5747c19a71f6440579e/src/Atmos/Parameterizations/CloudPhysics/Microphysics.jl#L131-L143">source</a></section><h2><a class="nav-anchor" id="References-1" href="#References-1">References</a></h2><p>@article{Grabowski<em>and</em>Smolarkiewicz_1996, author = {Grabowski, Wojciech W. and Smolarkiewicz, Piotr K.}, title = {Two-Time-Level Semi-Lagrangian Modeling of Precipitating Clouds}, journal = {Monthly Weather Review}, volume = {124}, number = {3}, pages = {487-497}, year = {1996}, doi = {10.1175/1520-0493(1996)124&lt;0487:TTLSLM&gt;2.0.CO;2}}</p><p>@article{Kessler_1995, author = {Kessler, E.}, title = {On the continuity and distribution of water substance in atmospheric circulations}, journal = {Atmospheric Research}, volume = {38}, number = {1}, pages = {109 - 145}, year = {1995}, doi = {10.1016/0169-8095(94)00090-Z}}</p><p>@book{Mason_1971, author = {Mason, B. J.}, title = {The Physics of Clouds}, publisher = {Oxford Univ. Press}, year = {1971}}</p><p>@article{Marshall<em>and</em>Palmer_1948, author = {Marshall, J. S. and Palmer, W. Mc K.}, title = {The distribution of raindrops with size}, journal = {Journal of Meteorology}, volume = {5}, number = {4}, pages = {165-166}, year = {1948}, doi = {10.1175/1520-0469(1948)005&lt;0165:TDORWS&gt;2.0.CO;2}}</p><p>@article{Ogura<em>and</em>Takahashi_1971, author = {Oqura, Yoshimitsu and Takahashi, Tsutomu}, title = {Numerical simulation of the life cycle of a thunderstorm cell}, journal = {Monthly Weather Review}, volume = {99}, number = {12}, pages = {895-911}, year = {1971}, doi = {10.1175/1520-0493(1971)099&lt;0895:NSOTLC&gt;2.3.CO;2}}</p><p>@article{Seifert<em>and</em>Beheng_2006, author={Seifert, A. and Beheng, K. D.}, title={A two-moment cloud microphysics parameterization for mixed-phase clouds. Part 1: Model description}, journal={Meteorology and Atmospheric Physics}, year={2006}, volume={92}, number={1}, pages={45–66}, doi={10.1007/s00703-005-0112-4}}</p><footer><hr/><a class="previous" href="EDMFEquations.html"><span class="direction">Previous</span><span class="title">Eddy-Diffusivity Mass-Flux (EDMF) equations</span></a><a class="next" href="../ODESolvers.html"><span class="direction">Next</span><span class="title">ODESolvers</span></a></footer></article></body></html>
